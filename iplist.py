import argparse
import sys
import requests
import csv


def _parse_args():
    parser = argparse.ArgumentParser(description='List API')
    parser.add_argument(
        '--token',
        type=str,
        help='RF API token as string',
        required=True)
    return parser.parse_args()


args = _parse_args()

urlAdd = 'https://api.recordedfuture.com/list/'
op_add = '/entities'
headers = {'content-type': 'application/json', 'X-RFToken': args.token, 'accept': 'application/json'}

userList = input('Which list would you like to download? Please type "all" or "mal" (no quotes)')

if userList == 'mal':
    listID = 'k9FzC6'
    f = open('mal.csv', 'w', newline='', encoding='utf-8')
    done = 'List of IPs downloaded in file "mal.csv"'
elif userList == 'all':
    listID = 'k9D4fl'
    f = open('all.csv', 'w', newline='', encoding='utf-8')
    done = 'List of IPs downloaded in file "all.csv"'
else:
    sys.exit(0)

r = requests.get(url=urlAdd + listID + op_add, headers=headers)

data = r.json()

writer = csv.writer(f)
for i in data:
    writer.writerow([i['entity']['name']])
f.close()
print(done)
sys.exit(0)
